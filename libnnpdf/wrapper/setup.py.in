from __future__ import print_function
import sys
import glob
from setuptools import setup, Extension, find_packages
import subprocess
import platform

import numpy

import setuptools.command.install
import shutil
from distutils.sysconfig import get_python_lib

if sys.version_info < (3, 4):
    print("Wrapper requires Python 3.4 or later", file=sys.stderr)
    sys.exit(1)


class CompiledLibInstall(setuptools.command.install.install):
    """
    Specialized install to install to python libs
    """

    def run(self):
        """
        Run method called by setup
        :return:
        """
        # Get filenames from CMake variable
        filenames = '${PYTHON_INSTALL_FILES}'.split(';')

        # Directory to install to
        install_dir = get_python_lib()

        # Install files
        [shutil.copy(filename, install_dir) for filename in filenames]


if __name__ == '__main__':
    setuptools.setup(
       name='NNPDF',
       version=@VERSION@,
       description="PDFs for phenomenology",
       author='NNPDF Collaboration',
       author_email='kassabov@to.infn.it',
       url='https://nnpdf.hepforge.org/',
       long_description="See README",
       # http://stackoverflow.com/questions/24799146/use-multiprocessing-process-inside-a-script-installed-by-setuptools
       package_dir={'': 'pylibs'},
       packages=find_packages('pylibs'),
       zip_safe=False,
       classifiers=[
            'License :: OSI Approved :: BSD License',
            'Operating System :: OS Independent',
            'Programming Language :: Python',
            'Topic :: Scientific/Engineering',
            'Topic :: Scientific/Engineering :: Physics',
            'Programming Language :: Python :: 3',
            'Programming Language :: Python :: 3.4',
            ],
        cmdclass={'install': CompiledLibInstall}
    )
